<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>æ–‡æœ¬å·®å¼‚å¯¹æ¯”å·¥å…· | åœ¨çº¿ä»£ç æ¯”å¯¹ - å¹»å½±å·¥å…·ç«™</title>
    <link rel="icon" href="/img/base64.png" type="image/png">
    <link rel="shortcut icon" href="/img/base64.png">
    <meta name="description" content="åœ¨çº¿æ–‡æœ¬æ¯”å¯¹å·¥å…·ï¼Œå¿«é€Ÿæ‰¾å‡ºä¸¤æ®µæ–‡æœ¬æˆ–ä»£ç ä¹‹é—´çš„å·®å¼‚ï¼Œæ”¯æŒé€è¡Œé«˜äº®æ˜¾ç¤ºï¼Œæé«˜æ ¡å¯¹æ•ˆç‡ã€‚">
    <meta name="keywords" content="æ–‡æœ¬å¯¹æ¯”,ä»£ç æ¯”å¯¹,åœ¨çº¿Diff,æ–‡æœ¬å·®å¼‚æ‰¾ä¸åŒ">
    
    <div style="position:absolute; left:-9999px;">
        <h2>åœ¨çº¿æ–‡æœ¬å·®å¼‚å¯¹æ¯” (Diff)</h2>
        <p>é€šè¿‡å¯¹æ¯”ä¸¤ä¸ªè¾“å…¥æ¡†ä¸­çš„å†…å®¹ï¼Œè‡ªåŠ¨è¯†åˆ«å¢åŠ ã€åˆ é™¤åŠä¿®æ”¹çš„å­—ç¬¦ï¼Œé€‚ç”¨äºä»£ç å®¡æ ¸åŠæ–‡æ¡£æ ¡å¯¹ã€‚</p>
    </div>
    <style>
        :root {
            --diff-red-text: #f5222d; 
            --diff-line-bg: #fff1f0; 
            --border: #d9d9d9;
            --line-height: 22px; 
        }

        body { 
            font-family: -apple-system, system-ui, sans-serif; 
            margin: 0; padding: 16px 30px 30px;
            background: #f0f2f5; color: #333; 
        }

        .header { 
            font-size: 16px; font-weight: 600; 
            margin: 0 auto 12px auto; max-width: 1400px;
            display: flex; align-items: center;
        }

        .header-icon { 
            background: #ff4d4f;
            color: #fff;
        
            width: 22px;          /* â† å›ºå®šå®½åº¦ */
            height: 22px;         /* â† å›ºå®šé«˜åº¦ï¼ˆæ­£æ–¹å½¢ï¼‰ */
        
            display: inline-flex; /* â† å±…ä¸­å…³é”® */
            align-items: center;
            justify-content: center;
        
            font-size: 14px;
            border-radius: 5px;
            margin-right: 8px;
            flex-shrink: 0;       /* é˜²æ­¢è¢«å‹ç¼© */
        }
        
        .container { 
            display: flex;
            gap: 25px;
            height: 620px;      /* â†‘ è¾“å…¥æ¡†æ›´é«˜ */
            max-width: 1400px;
            margin: 0 auto 16px auto;
        }

        .box { 
            flex: 1; display: flex; flex-direction: column; 
            background: #fff; border: 1px solid var(--border); 
            border-radius: 8px; overflow: hidden; box-shadow: 0 4px 12px rgba(0,0,0,0.08); 
        }

        .box-title { 
            background: #fafafa; padding: 12px 20px; 
            border-bottom: 1px solid var(--border); 
            font-size: 14px; color: #555; font-weight: 600;
        }
        
        .editor {
            flex: 1; padding: 10px 20px;  
            line-height: var(--line-height);
            overflow-y: auto; outline: none;
            font-family: 'Cascadia Code', 'Consolas', monospace; 
            font-size: 13px; 
            white-space: pre-wrap; word-break: break-all; color: #262626;
            background: #fff;
            /* éšè—æ¨ªå‘æ»šåŠ¨æ¡ä»¥é˜²å¹²æ‰°åŒæ­¥ */
            overflow-x: hidden; 
        }

        .line {
            padding: 0;
            height: var(--line-height);
            line-height: var(--line-height);
            box-sizing: border-box;
            margin: 0;
        }

        .line-diff {
            background-color: var(--diff-line-bg);
        }

        .char-diff { 
            color: var(--diff-red-text); 
            font-weight: bold;
        }
        .visual-hidden {
          position: absolute;
          width: 1px;
          height: 1px;
          padding: 0;
          margin: -1px;
          overflow: hidden;
          clip: rect(0, 0, 0, 0);
          white-space: nowrap;
          border: 0;
        }

        .btn-bar { 
            text-align: center;
            margin-top: 18px;     /* â† æ–°å¢ï¼šæŒ‰é’®å¾€ä¸‹ */
            margin-bottom: 32px;  /* â†“ ç•¥æ”¶ */
        }
        
        button { 
            background: #ff4d4f;
            color: white;
            border: none;
            padding: 10px 48px;   /* â†“ ç¼©å° */
            border-radius: 6px;
            cursor: pointer;
            font-size: 15px;     /* â†“ ç¼©å° */
            font-weight: 600;
            transition: all 0.2s;
        }

        button:hover { background: #ff7875; transform: translateY(-1px); }

        .hint { font-size: 13px; color: #8c8c8c; margin-top: 15px; }
    </style>
</head>
<body>
    <h1 class="visual-hidden">æ–‡æœ¬å·®å¼‚å¯¹æ¯”å·¥å…· | åœ¨çº¿ä»£ç æ¯”å¯¹</h1>
    <div id="back-home-bar" style="display:none; background:#eee; padding:5px; font-size:12px; border-bottom:1px solid #ddd;">
        <a href="index.html" target="_top" style="color:#666; text-decoration:none;">ğŸ  è¿”å›å¹»å½±å·¥å…·ç«™é¦–é¡µ</a>
    </div>
    
    <script>
        // å¦‚æœå½“å‰é¡µé¢ä¸æ˜¯åµŒå¥—åœ¨ iframe é‡Œï¼ˆå³ç‹¬ç«‹æ‰“å¼€ï¼‰ï¼Œåˆ™æ˜¾ç¤ºè¿”å›é¦–é¡µæ¡
        if (window.top === window.self) {
            document.getElementById('back-home-bar').style.display = 'block';
        }
    </script>
<a href="index.html" style="font-size: 1px; color: transparent; position: absolute; text-decoration: none;">å¹»å½±å·¥å…·ç«™é¦–é¡µ</a>
<div class="header"><span class="header-icon">â‡„</span> æ–‡æœ¬å·®å¼‚æ¯”å¯¹å·¥å…·</div>

<div class="container">
    <div class="box">
        <div class="box-title">åŸå§‹ç‰ˆæœ¬ (OLD)</div>
        <div id="old-editor" class="editor" contenteditable="true" spellcheck="false"></div>
    </div>
    <div class="box">
        <div class="box-title">ä¿®æ”¹ç‰ˆæœ¬ (NEW)</div>
        <div id="new-editor" class="editor" contenteditable="true" spellcheck="false"></div>
    </div>
</div>

<div class="btn-bar">
    <button onclick="runCompare()">ç«‹å³æ¯”è¾ƒå·®å¼‚</button>
    <div class="hint">å·²å¯ç”¨å·¦å³åŒæ­¥æ»šåŠ¨ã€‚å·®å¼‚è¡ŒèƒŒæ™¯å…¨è¡Œæµ…çº¢ï¼Œå·®å¼‚å­—ç¬¦çº¢å­—ã€‚</div>
</div>

<script>
    const oldEd = document.getElementById('old-editor');
    const newEd = document.getElementById('new-editor');

    // --- åŒæ­¥æ»šåŠ¨é€»è¾‘ ---
    let isScrolling = false;

    function syncScroll(el1, el2) {
        el1.addEventListener('scroll', () => {
            if (!isScrolling) {
                isScrolling = true;
                el2.scrollTop = el1.scrollTop;
                // ä½¿ç”¨å®šæ—¶å™¨é˜²æ­¢æ»šåŠ¨äº‹ä»¶æ— é™å¾ªç¯è§¦å‘
                setTimeout(() => { isScrolling = false; }, 50);
            }
        });
    }

    syncScroll(oldEd, newEd);
    syncScroll(newEd, oldEd);

    // --- æ¯”è¾ƒé€»è¾‘ ---
    function runCompare() {
        const textL = oldEd.innerText;
        const textR = newEd.innerText;

        const linesL = textL.replace(/\r\n/g, '\n').split('\n');
        const linesR = textR.replace(/\r\n/g, '\n').split('\n');

        const maxLines = Math.max(linesL.length, linesR.length);
        let htmlL = '';
        let htmlR = '';

        for (let i = 0; i < maxLines; i++) {
            const strL = linesL[i] || '';
            const strR = linesR[i] || '';

            if (strL === strR) {
                htmlL += `<div class="line">${escape(strL) || '&nbsp;'}</div>`;
                htmlR += `<div class="line">${escape(strR) || '&nbsp;'}</div>`;
            } else {
                const diff = getCharDiff(strL, strR);
                htmlL += `<div class="line line-diff">${diff.oldHtml || '&nbsp;'}</div>`;
                htmlR += `<div class="line line-diff">${diff.newHtml || '&nbsp;'}</div>`;
            }
        }
        
        oldEd.innerHTML = htmlL;
        newEd.innerHTML = htmlR;

        // æ¯”å¯¹åè‡ªåŠ¨é‡ç½®æ»šåŠ¨åˆ°é¡¶éƒ¨
        oldEd.scrollTop = 0;
        newEd.scrollTop = 0;
    }

    function getCharDiff(oldS, newS) {
        let oHtml = '', nHtml = '';
        let i = 0, j = 0;

        while (i < oldS.length || j < newS.length) {
            if (i < oldS.length && j < newS.length && oldS[i] === newS[j]) {
                oHtml += escape(oldS[i]);
                nHtml += escape(newS[j]);
                i++; j++;
            } else {
                let found = false;
                for (let k = 1; k < 15; k++) {
                    if (i + k < oldS.length && oldS[i + k] === newS[j]) {
                        oHtml += `<span class="char-diff">${escape(oldS.substring(i, i + k))}</span>`;
                        i += k; found = true; break;
                    }
                    if (j + k < newS.length && oldS[i] === newS[j + k]) {
                        nHtml += `<span class="char-diff">${escape(newS.substring(j, j + k))}</span>`;
                        j += k; found = true; break;
                    }
                }
                if (!found) {
                    if (i < oldS.length) oHtml += `<span class="char-diff">${escape(oldS[i++])}</span>`;
                    if (j < newS.length) nHtml += `<span class="char-diff">${escape(newS[j++])}</span>`;
                }
            }
        }
        return { oldHtml: oHtml, newHtml: nHtml };
    }

    function escape(str) {
        if(!str) return "";
        return str.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');
    }

    // æ ¼å¼åŒ–ç²˜è´´
    document.querySelectorAll('.editor').forEach(ed => {
        ed.addEventListener('paste', e => {
            e.preventDefault();
            const text = (e.originalEvent || e).clipboardData.getData('text/plain');
            document.execCommand("insertText", false, text);
        });
    });
</script>

</body>
</html>