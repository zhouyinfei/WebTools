<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<title>JSONåœ¨çº¿è§£æ | JSONæ ¼å¼åŒ–ç¾åŒ–å·¥å…· - å¹»å½±å·¥å…·ç«™</title>
<link rel="icon" href="/img/base64.png" type="image/png">
<link rel="shortcut icon" href="/img/base64.png">
<meta name="description" content="ä¸“ä¸šçš„JSONåœ¨çº¿æ ¼å¼åŒ–å·¥å…·ï¼Œæ”¯æŒJSONæ ¡éªŒã€å‹ç¼©ã€ç¾åŒ–åŠé”™è¯¯æç¤ºï¼Œå¸®åŠ©å¼€å‘è€…å¿«é€Ÿå¤„ç†JSONæ•°æ®ã€‚">
<meta name="keywords" content="JSONæ ¼å¼åŒ–,JSONè§£æ,JSONæ ¡éªŒ,JSONåœ¨çº¿å·¥å…·">

<div style="position:absolute; left:-9999px;">
    <h2>JSONåœ¨çº¿è§£æä¸æ ¼å¼åŒ–</h2>
    <p>æä¾›JSONæ•°æ®çš„ä¸€é”®ç¾åŒ–ã€å‹ç¼©ä»¥åŠè¯­æ³•æ£€æŸ¥åŠŸèƒ½ã€‚é€‚åˆå‰ç«¯ä¸åç«¯å¼€å‘è€…è°ƒè¯•æ¥å£æ•°æ®ã€‚</p>
</div>

<style>
body {
    font-family: Consolas, Monaco, monospace;
    background: #f2f2f2;
    padding: 10px;
    margin: 0;
    height: 100vh;
    box-sizing: border-box;
    display: flex;
    justify-content: center;
    align-items: flex-start;
}

.container {
    width: 100%;
    max-width: 1200px;   /* ä¿æŒåŸæ¥çš„æœ€å¤§å®½åº¦ */
    height: 85vh;        /* é«˜åº¦ç¨å°ï¼Œç•™å‡ºå¯¼èˆªæ ç©ºé—´ */
    background: #fff;
    padding: 15px;
    border-radius: 6px;
    box-shadow: 0 2px 8px rgba(0,0,0,.1);
    display: flex;
    flex-direction: column;
}

.editor {
    flex: 1;             /* è‡ªåŠ¨å¡«å……å‰©ä½™ç©ºé—´ */
    border: 1px solid #ccc;
    border-radius: 4px;
    overflow: auto;
    padding: 10px;
    white-space: pre;
    outline: none;
    font-size: 14px;
    line-height: 1.6;
    min-height: 300px;   /* ä¿è¯æœ€å°é«˜åº¦ */
}

.editor:focus {
    border-color: #4caf50;
}

/* JSON é«˜äº® */
.key { color: #881391; }
.string { color: #1a1aa6; }
.number { color: #1c00cf; }
.boolean { color: #aa0d91; }
.null { color: #808080; }

.btns {
    margin: 12px 0;
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
}

button {
    padding: 6px 14px;
    font-size: 13px;
    border: 1px solid #ccc;
    border-radius: 4px;
    background: #fafafa;
    cursor: pointer;
}

button.primary {
    background: #4caf50;
    color: #fff;
    border-color: #4caf50;
}

button.warn {
    background: #2196f3;
    color: #fff;
    border-color: #2196f3;
}

.tip {
    margin-top: 10px;
    padding: 8px;
    background: #fff8e1;
    border: 1px solid #ffe0b2;
    border-radius: 4px;
    font-size: 13px;
}

.error {
    color: #d32f2f;
}

/* ===== å¤åˆ¶æˆåŠŸæ°”æ³¡ï¼ˆæŒ‰é’®æ­£ä¸Šæ–¹ï¼‰ ===== */
.toast {
    position: fixed;
    background: rgba(60, 60, 60, 0.92);
    color: #fff;
    padding: 8px 14px;
    border-radius: 4px;
    font-size: 13px;
    opacity: 0;
    transform: translate(-50%, -90%);
    transition: opacity .25s ease, transform .25s ease;
    pointer-events: none;
    z-index: 9999;
    white-space: nowrap;
}
.visual-hidden {
  position: absolute;
  width: 1px;
  height: 1px;
  padding: 0;
  margin: -1px;
  overflow: hidden;
  clip: rect(0, 0, 0, 0);
  white-space: nowrap;
  border: 0;
}

.toast.show {
    opacity: 1;
    transform: translate(-50%, -100%);
}
</style>
</head>

<body>
    <h1 class="visual-hidden">JSONåœ¨çº¿æ ¼å¼åŒ–å·¥å…· - å…è´¹é«˜æ•ˆçš„ä»£ç ç¾åŒ–åˆ©å™¨</h1>
    <div id="back-home-bar" style="display:none; background:#eee; padding:5px; font-size:12px; border-bottom:1px solid #ddd;">
        <a href="index.html" target="_top" style="color:#666; text-decoration:none;">ğŸ  è¿”å›å¹»å½±å·¥å…·ç«™é¦–é¡µ</a>
    </div>
    
    <script>
        // å¦‚æœå½“å‰é¡µé¢ä¸æ˜¯åµŒå¥—åœ¨ iframe é‡Œï¼ˆå³ç‹¬ç«‹æ‰“å¼€ï¼‰ï¼Œåˆ™æ˜¾ç¤ºè¿”å›é¦–é¡µæ¡
        if (window.top === window.self) {
            document.getElementById('back-home-bar').style.display = 'block';
        }
    </script>
<a href="index.html" style="font-size: 1px; color: transparent; position: absolute; text-decoration: none;">å¹»å½±å·¥å…·ç«™é¦–é¡µ</a>
    
<div class="container">

<div id="editor" class="editor" contenteditable="true" spellcheck="false"></div>

<div class="btns">
    <button onclick="escapeJson()">Jsonè½¬ä¹‰</button>
    <button onclick="unescapeJson()">å»é™¤è½¬ä¹‰</button>
    <button onclick="compressEscape()">å‹ç¼©å¹¶è½¬ä¹‰</button>
    <button class="warn" onclick="compressJson()">Jsonå‹ç¼©</button>
    <button class="primary" onclick="formatJson()">Jsonæ ¼å¼åŒ–</button>
    <button onclick="jsonToGet()">è½¬GETå‚æ•°</button>
    <button id="copyBtn" onclick="copyText()">å¤åˆ¶</button>
    <button onclick="clearAll()">æ¸…ç©º</button>
</div>

<div id="tip" class="tip">è¯·è¾“å…¥ JSON</div>

</div>

<!-- Toast -->
<div id="toast" class="toast">å¤åˆ¶æˆåŠŸ</div>

<script>
let rawJsonText = '';
const editor = document.getElementById('editor');
editor.addEventListener('input', () => {
    rawJsonText = editor.textContent;
    highlight();
});
const tip = document.getElementById('tip');
const toast = document.getElementById('toast');
const copyBtn = document.getElementById('copyBtn');

/* ===== å…‰æ ‡å¤„ç†ï¼ˆæ ¸å¿ƒï¼‰ ===== */
function getCaretOffset(el) {
    const sel = window.getSelection();
    if (!sel.rangeCount) return 0;
    const range = sel.getRangeAt(0);
    const preRange = range.cloneRange();
    preRange.selectNodeContents(el);
    preRange.setEnd(range.endContainer, range.endOffset);
    return preRange.toString().length;
}

function setCaretOffset(el, offset) {
    const range = document.createRange();
    const sel = window.getSelection();
    let current = 0;

    function walk(node) {
        if (node.nodeType === Node.TEXT_NODE) {
            const next = current + node.length;
            if (offset <= next) {
                range.setStart(node, offset - current);
                range.collapse(true);
                return true;
            }
            current = next;
        } else {
            for (const child of node.childNodes) {
                if (walk(child)) return true;
            }
        }
        return false;
    }

    walk(el);
    sel.removeAllRanges();
    sel.addRange(range);
}

/* ===== ç¼–è¾‘ & é«˜äº® ===== */
// editor.addEventListener('input', highlight);

function getText() {
    return rawJsonText;
}

function setText(text) {
    rawJsonText = text;
    editor.textContent = text;
    highlight();
}

function highlight() {
    const caret = getCaretOffset(editor);
    const text = getText();
    editor.innerHTML = syntaxHighlight(text);
    setCaretOffset(editor, caret);
}

function syntaxHighlight(json) {
    json = json.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');
    return json.replace(/("(?:\\.|[^"])*")(\s*:)?|\b(true|false|null)\b|-?\d+(?:\.\d+)?/g,
        (m, str, isKey, bool) => {
            if (str) return isKey ? `<span class="key">${str}</span>${isKey}` : `<span class="string">${str}</span>`;
            if (bool) return `<span class="${bool==='null'?'null':'boolean'}">${bool}</span>`;
            return `<span class="number">${m}</span>`;
        }
    );
}

/* ===== åŠŸèƒ½ ===== */
function formatJson() { try { setText(JSON.stringify(JSON.parse(getText()), null, 4)); showTip('JSON æ ¼å¼åŒ–æˆåŠŸ'); } catch(e){ showError(e); } }
function compressJson() { try { setText(JSON.stringify(JSON.parse(getText()))); showTip('JSON å‹ç¼©æˆåŠŸ'); } catch(e){ showError(e); } }
function escapeJson() { setText(getText().replace(/\\/g,'\\\\').replace(/"/g,'\\"')); showTip('JSON è½¬ä¹‰å®Œæˆ'); }
function unescapeJson() { setText(getText().replace(/\\"/g,'"').replace(/\\\\/g,'\\')); showTip('å»é™¤è½¬ä¹‰å®Œæˆ'); }
function compressEscape() { try { const s = JSON.stringify(JSON.parse(getText())); setText(s.replace(/\\/g,'\\\\').replace(/"/g,'\\"')); showTip('å‹ç¼©å¹¶è½¬ä¹‰å®Œæˆ'); } catch(e){ showError(e); } }
function jsonToGet() { try { const obj = JSON.parse(getText()); setText(Object.keys(obj).map(k=>`${k}=${obj[k]}`).join('&')); showTip('GET å‚æ•°ç”ŸæˆæˆåŠŸ'); } catch(e){ showError(e); } }
function copyText() { 
    const text = getText();
    if(!text){ showError(new Error('æ²¡æœ‰å¯å¤åˆ¶çš„å†…å®¹')); return; }
    navigator.clipboard.writeText(text).then(()=>{ showTip('å·²å¤åˆ¶'); showToast('å¤åˆ¶æˆåŠŸ'); })
    .catch(()=>{ showError(new Error('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶')); });
}
function clearAll() { editor.innerHTML=''; showTip('å·²æ¸…ç©º'); }

/* ===== æç¤º ===== */
function showTip(msg) { tip.textContent = msg; tip.className='tip'; }
function showError(e) { tip.innerHTML = 'JSON æ ¼å¼é”™è¯¯<br>' + e.message; tip.className='tip error'; }

/* ===== Toast ===== */
function showToast(msg) {
    toast.textContent = msg;
    const rect = copyBtn.getBoundingClientRect();
    toast.style.left = rect.left + rect.width/2 + 'px';
    toast.style.top = rect.top - 12 + 'px';
    toast.classList.add('show');
    clearTimeout(toast._timer);
    toast._timer = setTimeout(()=>{ toast.classList.remove('show'); }, 1600);
}
</script>
</body>
</html>
